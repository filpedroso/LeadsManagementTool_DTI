// ===================================================================
// FILE: docker-compose.yml
// ===================================================================

version: '3.8'

services:
  # SQL Server Database
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: leads_sqlserver
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: "YourPassword123!"
      MSSQL_PID: "Express"
    ports:
      - "1433:1433"
    volumes:
      - sqlserver_data:/var/opt/mssql
    healthcheck:
      test: ["CMD-SHELL", "/opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P YourPassword123! -Q 'SELECT 1' || exit 1"]
      interval: 10s
      timeout: 3s
      retries: 3
      start_period: 10s
    networks:
      - leads_network

  # .NET Core API
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: leads_api
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: https://+:7000
      ASPNETCORE_Kestrel__Certificates__Default__Path: /https/aspnetapp.pfx
      ASPNETCORE_Kestrel__Certificates__Default__Password: "password"
      ConnectionStrings__DefaultConnection: "Server=sqlserver,1433;Database=LeadsManagementDb;User Id=sa;Password=YourPassword123!;TrustServerCertificate=true;"
    ports:
      - "7000:7000"
    depends_on:
      sqlserver:
        condition: service_healthy
    volumes:
      - ${USERPROFILE}/.aspnet/https:/https:ro
      - ./src:/app/src
    networks:
      - leads_network

  # React Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: leads_frontend
    ports:
      - "3000:3000"
    environment:
      VITE_API_BASE_URL: https://localhost:7000/api/v1
    depends_on:
      - api
    volumes:
      - ./frontend/src:/app/src
    networks:
      - leads_network

volumes:
  sqlserver_data:

networks:
  leads_network:
    driver: bridge

// ===================================================================
// FILE: Dockerfile (API)
// ===================================================================

# Build stage
FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
WORKDIR /app

# Copy solution and project files
COPY ["LeadsManagement.sln", "."]
COPY ["src/LeadsManagement.API/LeadsManagement.API.csproj", "src/LeadsManagement.API/"]
COPY ["src/LeadsManagement.Application/LeadsManagement.Application.csproj", "src/LeadsManagement.Application/"]
COPY ["src/LeadsManagement.Domain/LeadsManagement.Domain.csproj", "src/LeadsManagement.Domain/"]
COPY ["src/LeadsManagement.Infrastructure/LeadsManagement.Infrastructure.csproj", "src/LeadsManagement.Infrastructure/"]

# Restore dependencies
RUN dotnet restore "LeadsManagement.sln"

# Copy source code
COPY . .

# Build
RUN dotnet build "LeadsManagement.sln" -c Release -o /app/build

# Publish
RUN dotnet publish "src/LeadsManagement.API/LeadsManagement.API.csproj" -c Release -o /app/publish

# Runtime stage
FROM mcr.microsoft.com/dotnet/aspnet:6.0
WORKDIR /app
COPY --from=build /app/publish .

# Generate self-signed certificate
RUN apt-get update && apt-get install -y openssl
RUN openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes -subj "/CN=localhost"
RUN openssl pkcs12 -export -in cert.pem -inkey key.pem -out aspnetapp.pfx -passout pass:password

ENTRYPOINT ["dotnet", "LeadsManagement.API.dll"]

// ===================================================================
// FILE: frontend/Dockerfile
// ===================================================================

# Build stage
FROM node:18-alpine AS build
WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .
RUN npm run build

# Production stage
FROM node:18-alpine
WORKDIR /app

RUN npm install -g serve

COPY --from=build /app/dist ./dist

EXPOSE 3000
CMD ["serve", "-s", "dist", "-l", "3000"]

// ===================================================================
// FILE: .gitignore
// ===================================================================

/*
# IDE
.vs/
.vscode/
*.swp
*.swo
*~
.DS_Store

# Build output
bin/
obj/
dist/
build/

# Dependencies
node_modules/
packages/

# Environment files
.env
.env.local
.env.*.local

# Database
*.mdf
*.ldf

# Logs
logs/
*.log

# Runtime
/emails/

# OS
Thumbs.db
.DS_Store

# Package manager locks
package-lock.json
yarn.lock
*/

// ===================================================================
// FILE: INSTALL_GUIDE.md
// ===================================================================

/*
# üìö GUIA DE INSTALA√á√ÉO - Leads Management System

## Pr√©-requisitos

- **.NET 6 SDK** - https://dotnet.microsoft.com/download/dotnet/6.0
- **SQL Server 2022 Express** - https://www.microsoft.com/pt-br/sql-server/sql-server-downloads
- **Node.js 18+** - https://nodejs.org/
- **Git** - https://git-scm.com/
- **Docker** (opcional) - https://www.docker.com/

## Instala√ß√£o Local (Sem Docker)

### 1. Backend Setup

\`\`\`bash
# Clone o reposit√≥rio
git clone <seu-repositorio-url>
cd LeadsManagement

# Restaurar depend√™ncias
dotnet restore

# Aplicar migra√ß√µes (cria o banco de dados)
cd src/LeadsManagement.Infrastructure
dotnet ef database update --startup-project ../LeadsManagement.API

# Rodar a API
cd ../LeadsManagement.API
dotnet run
\`\`\`

A API estar√° dispon√≠vel em: https://localhost:7000

### 2. Frontend Setup

\`\`\`bash
# Em outra aba do terminal
cd frontend

# Instalar depend√™ncias
npm install

# Rodar servidor de desenvolvimento
npm run dev
\`\`\`

O frontend estar√° dispon√≠vel em: http://localhost:3000

## Instala√ß√£o com Docker

\`\`\`bash
# Build e rodar todos os servi√ßos
docker-compose up -d

# Acompanhar logs
docker-compose logs -f

# Parar servi√ßos
docker-compose down
\`\`\`

## Connection String do Banco de Dados

**Desenvolvimento (Local):**
\`\`\`
Server=.;Database=LeadsManagementDb;Trusted_Connection=true;TrustServerCertificate=true;
\`\`\`

**Docker:**
\`\`\`
Server=sqlserver,1433;Database=LeadsManagementDb;User Id=sa;Password=YourPassword123!;TrustServerCertificate=true;
\`\`\`

## Verificar Emails Simulados

Os emails simulados s√£o salvos em: `src/LeadsManagement.API/emails/`

## Rodar Testes

\`\`\`bash
# Executar todos os testes
dotnet test

# Com cobertura
dotnet test /p:CollectCoverage=true
\`\`\`

## Troubleshooting

### Erro de certificado HTTPS
Se receber erro de certificado SSL:

\`\`\`bash
dotnet dev-certs https --clean
dotnet dev-certs https --trust
\`\`\`

### Banco de dados n√£o √© criado
Verificar se SQL Server est√° rodando:

\`\`\`bash
# No SSMS, conectar a (.) ou localhost
\`\`\`

### Frontend n√£o conecta na API
Verificar se CORS est√° habilitado no appsettings.Development.json

### Docker com permiss√µes
Em Linux/Mac, pode ser necess√°rio:

\`\`\`bash
sudo docker-compose up -d
\`\`\`
*/

// ===================================================================
// FILE: ARCHITECTURE.md
// ===================================================================

/*
# üèóÔ∏è ARQUITETURA DO PROJETO

## Clean Architecture + Vertical Slices

Este projeto segue padr√µes modernos de desenvolvimento:

### Camadas

#### 1. **Domain Layer** (LeadsManagement.Domain)
- Entidades e Value Objects puros
- L√≥gica de neg√≥cio central
- Sem depend√™ncias externas
- Altamente test√°vel

\`\`\`
Domain/
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îî‚îÄ‚îÄ Lead.cs (Agregado raiz)
‚îú‚îÄ‚îÄ ValueObjects/
‚îÇ   ‚îú‚îÄ‚îÄ Money.cs
‚îÇ   ‚îî‚îÄ‚îÄ Contact.cs
‚îú‚îÄ‚îÄ Enums/
‚îÇ   ‚îî‚îÄ‚îÄ LeadStatus.cs
‚îî‚îÄ‚îÄ Events/
    ‚îú‚îÄ‚îÄ LeadAcceptedEvent.cs
    ‚îî‚îÄ‚îÄ LeadDeclinedEvent.cs
\`\`\`

#### 2. **Application Layer** (LeadsManagement.Application)
- CQRS (Commands & Queries)
- DTOs (Data Transfer Objects)
- Handlers usando MediatR
- L√≥gica de aplica√ß√£o

\`\`\`
Application/
‚îú‚îÄ‚îÄ Common/
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Result.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ApiException.cs
‚îÇ   ‚îî‚îÄ‚îÄ Interfaces/
‚îú‚îÄ‚îÄ Features/
‚îÇ   ‚îî‚îÄ‚îÄ Leads/
‚îÇ       ‚îú‚îÄ‚îÄ Commands/
‚îÇ       ‚îú‚îÄ‚îÄ Queries/
‚îÇ       ‚îú‚îÄ‚îÄ DTOs/
‚îÇ       ‚îî‚îÄ‚îÄ Validators/
\`\`\`

#### 3. **Infrastructure Layer** (LeadsManagement.Infrastructure)
- Entity Framework Core (ORM)
- Reposit√≥rios
- Servi√ßos (Email, Logging)
- Configura√ß√µes de BD

\`\`\`
Infrastructure/
‚îú‚îÄ‚îÄ Data/
‚îÇ   ‚îú‚îÄ‚îÄ Contexts/ApplicationDbContext.cs
‚îÇ   ‚îú‚îÄ‚îÄ Configurations/
‚îÇ   ‚îú‚îÄ‚îÄ Migrations/
‚îÇ   ‚îî‚îÄ‚îÄ Repositories/
‚îî‚îÄ‚îÄ Services/
    ‚îî‚îÄ‚îÄ EmailService.cs
\`\`\`

#### 4. **Presentation Layer** (LeadsManagement.API)
- Controllers ASP.NET Core
- Middleware
- Configura√ß√µes de DI
- Program.cs

\`\`\`
API/
‚îú‚îÄ‚îÄ Controllers/LeadsController.cs
‚îú‚îÄ‚îÄ Middleware/ErrorHandlingMiddleware.cs
‚îú‚îÄ‚îÄ Extensions/ServiceCollectionExtensions.cs
‚îú‚îÄ‚îÄ Program.cs
‚îî‚îÄ‚îÄ appsettings.json
\`\`\`

### Padr√µes Utilizados

#### CQRS (Command Query Responsibility Segregation)
- Separa leitura de escrita
- Commands modificam estado
- Queries apenas consultam

#### Repository Pattern
- Abstra√ß√£o do acesso a dados
- Facilita testes e manuten√ß√£o

#### Dependency Injection
- IoC Container nativo do ASP.NET Core
- Registrado em ServiceCollectionExtensions

#### Value Objects
- Imut√°veis
- Encapsulam l√≥gica de dom√≠nio
- Exemplo: Money, Contact

#### Domain Events
- Comunica√ß√£o entre agregados
- Desacoplamento de componentes

### Fluxo de Requisi√ß√£o

\`\`\`
Cliente (React)
    ‚Üì
HTTP Request
    ‚Üì
Controller (LeadsController)
    ‚Üì
MediatR
    ‚Üì
Handler (AcceptLeadCommandHandler)
    ‚Üì
Domain Logic (Lead.Accept())
    ‚Üì
Repository (LeadRepository)
    ‚Üì
Entity Framework Core
    ‚Üì
SQL Server
    ‚Üì
Response (JSON)
\`\`\`

### Regras de Neg√≥cio Implementadas

1. **Desconto Autom√°tico**: Leads com pre√ßo > $500 recebem 10% de desconto ao aceitar
2. **Notifica√ß√£o por Email**: Ao aceitar, envia email para vendas@test.com
3. **Status Management**: Leads come√ßam como "Invited", podem ir para "Accepted" ou "Declined"
4. **Imutabilidade de Status**: Uma vez "Accepted" ou "Declined", n√£o pode mudar

### Testing Strategy

- **Unit Tests**: L√≥gica de dom√≠nio (LeadTests)
- **Integration Tests**: Handlers e reposit√≥rios
- **Padr√£o AAA**: Arrange, Act, Assert
- **Mocks**: Isolar depend√™ncias externas
*/

// ===================================================================
// FILE: API_DOCUMENTATION.md
// ===================================================================

/*
# üìñ DOCUMENTA√á√ÉO DA API

## Base URL
\`\`\`
https://localhost:7000/api/v1
\`\`\`

## Endpoints

### 1. Listar Leads por Status
\`\`\`
GET /leads/status/{status}
\`\`\`

**Par√¢metros:**
- \`status\` (string): "Invited", "Accepted" ou "Declined"

**Resposta (200 OK):**
\`\`\`json
[
  {
    "id": 1,
    "contactFirstName": "Jo√£o",
    "contactLastName": "Silva",
    "contactEmail": "joao@email.com",
    "contactPhoneNumber": "11999999999",
    "dateCreated": "2025-11-27T10:30:00Z",
    "suburb": "S√£o Paulo",
    "category": "Tecnologia",
    "description": "Venda de software",
    "price": 900.00,
    "status": "Accepted"
  }
]
\`\`\`

### 2. Buscar Lead Espec√≠fico
\`\`\`
GET /leads/{id}
\`\`\`

**Par√¢metros:**
- \`id\` (int): ID do lead

**Resposta (200 OK):**
\`\`\`json
{
  "id": 1,
  "contactFirstName": "Jo√£o",
  "contactLastName": "Silva",
  "contactEmail": "joao@email.com",
  "contactPhoneNumber": "11999999999",
  "dateCreated": "2025-11-27T10:30:00Z",
  "suburb": "S√£o Paulo",
  "category": "Tecnologia",
  "description": "Venda de software",
  "price": 900.00,
  "status": "Accepted"
}
\`\`\`

### 3. Criar Novo Lead
\`\`\`
POST /leads
\`\`\`

**Body (JSON):**
\`\`\`json
{
  "contactFirstName": "Maria",
  "contactLastName": "Santos",
  "contactEmail": "maria@email.com",
  "contactPhoneNumber": "21987654321",
  "suburb": "Rio de Janeiro",
  "category": "Im√≥vel",
  "description": "Propriedade comercial",
  "price": 1500.00
}
\`\`\`

**Resposta (201 Created):**
\`\`\`json
{
  "id": 2
}
\`\`\`

### 4. Aceitar Lead
\`\`\`
POST /leads/{id}/accept
\`\`\`

**Par√¢metros:**
- \`id\` (int): ID do lead

**Comportamento:**
- Muda status para "Accepted"
- Se pre√ßo > $500, aplica 10% de desconto
- Envia email para vendas@test.com

**Resposta (200 OK):**
\`\`\`json
{
  "message": "Lead 1 accepted successfully"
}
\`\`\`

### 5. Recusar Lead
\`\`\`
POST /leads/{id}/decline
\`\`\`

**Par√¢metros:**
- \`id\` (int): ID do lead

**Resposta (200 OK):**
\`\`\`json
{
  "message": "Lead 1 declined successfully"
}
\`\`\`

## C√≥digos de Erro

| C√≥digo | Significado |
|--------|-------------|
| 200 | OK - Requisi√ß√£o bem sucedida |
| 201 | Created - Recurso criado |
| 400 | Bad Request - Dados inv√°lidos |
| 404 | Not Found - Recurso n√£o encontrado |
| 500 | Internal Server Error - Erro no servidor |

## Exemplo de Fluxo Completo

\`\`\`bash
# 1. Criar um novo lead
curl -X POST https://localhost:7000/api/v1/leads \\
  -H "Content-Type: application/json" \\
  -d '{
    "contactFirstName": "Pedro",
    "suburb": "Bras√≠lia",
    "category": "Servi√ßos",
    "description": "Consultoria",
    "price": 600
  }'

# Resposta: { "id": 3 }

# 2. Listar leads convidados
curl https://localhost:7000/api/v1/leads/status/Invited

# 3. Aceitar o lead (com desconto aplicado)
curl -X POST https://localhost:7000/api/v1/leads/3/accept

# 4. Verificar se foi aceito
curl https://localhost:7000/api/v1/leads/3

# Resposta mostrar√° price reduzido para 540 (10% desconto de 600)
\`\`\`
*/
